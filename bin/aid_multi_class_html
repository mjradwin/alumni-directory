#!/usr/bin/perl -w

#
# does the html multi_class pages
# $Id: aid_multi_class_html,v 3.16 1998/11/02 21:43:49 mradwin Exp mradwin $
#

require 'aid_util.pl';
require 'getopts.pl';

$usage = 'usage: aid_multi_class_html [-h] infile.adr
    -h        Display usage information.
';

&Getopts('h') || die "$usage\n";
$opt_h && die "$usage\n";
$ARGV[0] || die "$usage\n";
$opt_h = $opt_h;		# avoid warning

open(DATA,$ARGV[0]) || die "Can't open $ARGV[0]: $!\n";

@years = ();
@db = ();

while(<DATA>) {
    chop;
    %rec = &aid_split($_);
    next unless $rec{'valid'};

    push(@db,$_);
    &aid_build_yearlist(*years, $rec{'year'});
}

$prev = '';
while (defined($_ = shift(@db))) {
    %rec = &aid_parse($_);

    if ($prev ne $rec{'year'} && $prev ne 'other') {
	if ($prev ne '') {
	    print FMTOUT &common_html_ftr(-1);
	    close(FMTOUT);
	}

	$prev = ($rec{'year'} =~ /^\d+$/) ? $rec{'year'} : 'other';
	$outFile = &aid_config('wwwdir') . "class/${prev}.html";

	open(FMTOUT,">$outFile") || die "Can't open $outFile: $!\n";

	$title  = ($rec{'year'} =~ /^\d+$/) ? "Class of $rec{'year'}" :
	    "Faculty and Staff";
	print FMTOUT &common_html_hdr(-1,$title,1);
	print FMTOUT &common_intro_para(0);
	print FMTOUT &aid_class_jump_bar('', '.html', *years, 1, $prev);
	print FMTOUT "<hr noshade size=1>\n\n";
    }

    print FMTOUT &aid_verbose_entry(*rec);
}

print FMTOUT &common_html_ftr(-1);
close(FMTOUT);

# index page
$outFile = &aid_config('wwwdir') . "class/index.html";
open(FMTOUT,">$outFile") || die "Can't open $outFile: $!\n";

print FMTOUT &common_html_hdr(2,'Listed by Graduating Class',0);

print FMTOUT "<p align=center><big>By&nbsp;Class:<br>\n";
print FMTOUT &aid_class_jump_bar('', '.html', *years, 0);
print FMTOUT "</big></p>\n\n";

print FMTOUT "<p align=center><big>";
print FMTOUT "Compact&nbsp;Form:<br>\n";
print FMTOUT "<a href=\"all.html\">";
print FMTOUT "All&nbsp;Alumni</a> (~ 240 kbytes)<br>\n";
print FMTOUT "<a href=\"awalt.html\">";
print FMTOUT "Awalt&nbsp;Alumni</a> (~ 50 kbytes)</big></p>\n";

print FMTOUT &common_html_ftr(2);
close(FMTOUT);

exit(0);
