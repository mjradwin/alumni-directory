#!/usr/local/bin/perl -w

#
# does the html version of the alphabetical address list
# $Id: aid_alpha_html,v 2.1 1998/03/31 19:55:13 mjr Exp mradwin $
#

require 'aid_util.pl';
require 'getopts.pl';

$usage = 'usage: aid_alpha_html [-ht] infile.adr outfile
    -h        Display usage information.
    -t        Output text only
';

&Getopts('ht') || die "$usage\n";
$opt_h && die "$usage\n";
$ARGV[0] || die "$usage\n";
$ARGV[1] || die "$usage\n";
$opt_h = $opt_h;		# avoid warning

$info_gif = &aid_image_tag('info');
$blank_gif = ($opt_t) ? "" : &aid_image_tag('blank');
$cgi = &aid_config('cgi_path');

open(DATA,$ARGV[0]) || die "Can't open $ARGV[0]: $!\n";
open(FMTOUT,">$ARGV[1]") || die "Can't open $ARGV[1]: $!\n";

if (!$opt_t) {
    print FMTOUT &common_html_hdr(1,'Alumni Listed by Last Name',1);
    print FMTOUT &common_intro_para(1);
    print FMTOUT "<p><a name=\"top\">Index</a>: <tt>";
    # do the funky quick-jump bar
    $initial = 'A';
    while ($initial ne 'AA') {
	print FMTOUT "<a href=\"#last$initial\">$initial</a>\n";
	$initial++;
    }
    print FMTOUT "</tt>";
    print FMTOUT "\n<p>\n<pre>";
}

print FMTOUT "Name and Graduation Year$blank_gif                 Email\n";
print FMTOUT "---------------------------------------------------------------------------";

$initial = "Z";
while(<DATA>) {
    chop;
    %rec = &aid_parse($_);

    if ($initial ne substr($rec{'last'}, 0, 1)) {
	$initial = substr($rec{'last'}, 0, 1);
	print FMTOUT "\n";
	$opt_t || print FMTOUT "<a name=\"last$initial\">";
	print FMTOUT $initial;
	$opt_t || print FMTOUT "</a> (<a href=\"#top\">top</a>)";
	print FMTOUT "\n";
    }

    $fullname = &fullname(*rec);
    ($affil,$len) = &affiliate(*rec,!$opt_t);

    print FMTOUT ' ';
    $opt_t || print FMTOUT "<a href=\"$cgi?about=$rec{'id'}\">$info_gif</a>";
    $opt_t || print FMTOUT "<a name=\"$rec{'alias'}\"";
    $opt_t || print FMTOUT " href=\"$rec{'homepage'}\"" if $rec{'homepage'} ne '';
    $opt_t || print FMTOUT ">";
    print FMTOUT $fullname;
    $opt_t || print FMTOUT "</a>";
    print FMTOUT $affil;
    print FMTOUT ' ', ' ' x (39 - (length($fullname) + $len));
    $opt_t || print FMTOUT "<a href=\"mailto:", $rec{'email'}, "\">";
    print FMTOUT $rec{'email'};
    $opt_t || print FMTOUT "</a>";
    $opt_t || print FMTOUT " " . &aid_image_tag('new_anchored') if &is_new($rec{'time'});
    print FMTOUT "\n";
}

$opt_t || print FMTOUT "</pre>\n";
$opt_t || print FMTOUT &common_html_ftr(1);

exit(0);
