#!/usr/bin/perl -w

#
# does the html version of the recent address list
# $Id: aid_recent_html,v 3.13 1998/10/09 20:52:58 mradwin Exp mradwin $
#

require 'aid_util.pl';
require 'getopts.pl';

$usage = 'usage: aid_recent_html [-ht] [-m <mos>] infile.adr outfile
    -h        Display usage information.
    -t        Output text only.
    -m <mos>  Define "recent" to mean <mos> months (default 1).
';

&Getopts('htm:') || die "$usage\n";
$opt_h && die "$usage\n";
$ARGV[0] || die "$usage\n";
$ARGV[1] || die "$usage\n";
$opt_h = $opt_h;		# avoid warning

open(DATA,$ARGV[0]) || die "Can't open $ARGV[0]: $!\n";
open(FMTOUT,">$ARGV[1]") || die "Can't open $ARGV[1]: $!\n";

if (!$opt_t) {
print FMTOUT &common_html_hdr(5,'Recent Additions to the Directory',1);
print FMTOUT
"<p>All entries on this page have been added to the Directory within the
last month.</p>\n\n";
}

$opt_m = 1 unless $opt_m;

@newbies = ();
while(<DATA>) {
    chop;
    %rec = &aid_split($_);
    next unless $rec{'valid'};
    next unless &is_new($rec{'time'}, $opt_m);
    push(@newbies,$_);
}

if ($opt_t) {
    print FMTOUT "Name and Graduation Year                 Email\n";
    print FMTOUT "---------------------------------------------------------------------------\n";

    while (defined($_ = shift(@newbies))) {
	%rec = &aid_parse($_);

	$fullname = &fullname(*rec);
	($affil,$len) = &affiliate(*rec,0);

	print FMTOUT $fullname, $affil, ' ';
	print FMTOUT ' ' x (40 - (length($fullname) + $len));
	print FMTOUT $rec{'email'}, "\n";
    }

} else {
#    while (defined($_ = pop(@newbies))) {
    while (defined($_ = shift(@newbies))) {
	%rec = &aid_parse($_);
	&aid_write_verbose_entry(*FMTOUT,*rec,1,1);
    }
}

$opt_t || print FMTOUT &common_html_ftr(5);

exit(0);
