#!/usr/local/bin/perl

# does the html version of just home pages
#

@INC=('/u/mjr/doc/mvhs', '/usr/local/lib/perl');
require 'mv_util.pl';
require 'getopts.pl';
require 'ctime.pl';

$usage = 'usage: mv_www_html [-h] infile.adr outfile
    -h        Display usage information.
';

&Getopts('h') || die "$usage\n";
$opt_h && die "$usage\n";
$ARGV[0] || die "$usage\n";
$ARGV[1] || die "$usage\n";

open(MVHS,$ARGV[0]) || die "Can't open $ARGV[0]: $!\n";
open(FMTOUT,">$ARGV[1]") || die "Can't open $ARGV[1]: $!\n";

print FMTOUT &common_html_hdr(4);
print FMTOUT "<br>
<table cellspacing=0 cellpadding=1 border=0 width=\"100%\">
  <tr>
    <td bgcolor=\"#000000\" align=center>
    <table cellspacing=0 cellpadding=5 border=0 width=\"100%\">
      <tr>
        <td bgcolor=\"#eeee88\" align=center valign=middle>
        <strong><font size=\"+1\">A</font>&nbsp;L&nbsp;U&nbsp;M&nbsp;N&nbsp;I&nbsp;&nbsp; W&nbsp;I&nbsp;T&nbsp;H&nbsp;&nbsp; <font size=\"+1\">W</font>&nbsp;E&nbsp;B&nbsp;&nbsp; <font size=\"+1\">P</font>&nbsp;A&nbsp;G&nbsp;E&nbsp;S</strong>
        </td>
      </tr>
    </table>
    </td>
  </tr>
</table>
";
print FMTOUT "<pre>";
print FMTOUT "Name and Graduation Year                  Email\n";
print FMTOUT "---------------------------------------------------------------------------\n";

while(<MVHS>) {
    chop;
    ($time,$id,$req,$last,$first,$school,$year,$email,$alias,$homepage) = &mv_parse($_);
    next unless $homepage ne '';

    if ($first) {
       $fullname = "$last, $first";
    } else {
       $fullname = $last;
    }

    if ($year =~ /^\d+$/) {
	$affil  = "  '$year";
	$affil .= " $school" 
	    if $school ne 'MVHS' && $school ne '';
    } else {
	$affil  = "  [$school $year]";
    }
    $affil_tmp = $affil;
    $affil_tmp =~ s/<[^>]+>//g;
    $affil_len = length($affil_tmp);

    print FMTOUT "<a name=\"$alias\"";
    print FMTOUT " href=\"$homepage\"";
    print FMTOUT ">";
    print FMTOUT $fullname;
    print FMTOUT "</a>";
    print FMTOUT $affil;
    print FMTOUT ' ' x (42 - (length($fullname) + $affil_len));
    print FMTOUT "<a href=\"mailto:", $email, "\">", $email, "</a>";
    print FMTOUT " <img alt=\"[new]\" WIDTH=28 HEIGHT=11 SRC=\"new.gif\">" if &is_new($time);
    print FMTOUT "\n";
}

print FMTOUT "</pre>\n";
print FMTOUT &common_html_ftr;

exit(0);
