#!/usr/bin/perl -w

#
# does the html version of the grad-date address list
# $Id: aid_class_html,v 3.18 1998/11/02 21:43:49 mradwin Exp mradwin $
#

require 'aid_util.pl';
require 'getopts.pl';

$usage = 'usage: aid_class_html [-hta] infile.adr outfile
    -h        Display usage information.
    -t        Output text only
    -a        Awalt mode.
';

&Getopts('htaw') || die "$usage\n";
$opt_h && die "$usage\n";
$ARGV[0] || die "$usage\n";
$ARGV[1] || die "$usage\n";
$opt_h = $opt_h;		# avoid warning

$info_gif = &aid_image_tag('info');
$blank_gif = ($opt_t) ? "" : &aid_image_tag('blank');

open(DATA,$ARGV[0]) || die "Can't open $ARGV[0]: $!\n";
open(FMTOUT,">$ARGV[1]") || die "Can't open $ARGV[1]: $!\n";

@years = ();
@db = ();

while(<DATA>) {
    chop;
    %rec = &aid_split($_);
    next unless $rec{'valid'};

    push(@db,$_);
    &aid_build_yearlist(*years, $rec{'year'});
}

if (!$opt_t) {
    $title  = $opt_a ? 'Awalt Alumni' : 'Listed by Graduating Class';
    print FMTOUT &common_html_hdr(($opt_a ? 3 : -1),$title,1);
    print FMTOUT &common_intro_para(1);
    print FMTOUT &aid_class_jump_bar('#grad','',*years,0);
    print FMTOUT "<pre>";
}

print FMTOUT "Name$blank_gif                                     E-Mail\n";
print FMTOUT "---------------------------------------------------------------------------";

$prev = '1900';
while (defined($_ = shift(@db))) {
    %rec = &aid_parse($_);

    if ($prev ne $rec{'year'}) {
	print FMTOUT "\n";
	if ($rec{'year'} =~ /^\d+$/) {
            $opt_t || print FMTOUT "<a name=\"grad$rec{'year'}\" " .
                "href=\"" . &aid_config('master_path') .
		"class/$rec{'year'}.html\">";
	    print FMTOUT "Class of $rec{'year'}";
	    $opt_t || print FMTOUT "</a>  (<a href=\"#top\">top</a>)";
	    print FMTOUT "\n";

	} else {
	    $opt_t || print FMTOUT "<a name=\"gradother\">" if $prev =~ /^\d+$/;
	    print FMTOUT $rec{'year'};
	    $opt_t || print FMTOUT "</a>" if $prev =~ /^\d+$/;
	    print FMTOUT ' ' x (13 - length($rec{'year'}));
	    $opt_t || print FMTOUT "  (<a href=\"#top\">top</a>)";
	    print FMTOUT "\n";
	}

	$prev = $rec{'year'};
    }

    $fullname = &fullname(*rec);
    $regschool = ($opt_a) ? 'Awalt' : 'MVHS';

    if ($rec{'school'} ne $regschool && $rec{'school'} ne '') {
	$affil     = "  [$rec{'school'}]";
    } else {
	$affil     = "";
    }

    print FMTOUT ' ';
    $opt_t || print FMTOUT "<a href=\"" . &aid_about_path(*rec) . "\">$info_gif</a>"; #'#
    $opt_t || print FMTOUT "<a name=\"$rec{'alias'}\"";
    $opt_t || print FMTOUT " href=\"$rec{'www'}\"" if $rec{'www'} ne '';
    $opt_t || print FMTOUT ">";
    print FMTOUT $fullname;
    $opt_t || print FMTOUT "</a>";
    print FMTOUT $affil;
    print FMTOUT ' ', ' ' x (39 - (length($fullname) + length($affil)));
    $opt_t || print FMTOUT "<a href=\"mailto:", $rec{'email'}, "\">";
    print FMTOUT $rec{'email'};
    $opt_t || print FMTOUT "</a>";
    $opt_t || print FMTOUT " " . &aid_image_tag('new_anchored') if &is_new($rec{'time'});
    print FMTOUT "\n";
}

$opt_t || print FMTOUT "</pre>\n";
$opt_t || print FMTOUT &common_html_ftr($opt_a ? 3 : -1);

exit(0);
