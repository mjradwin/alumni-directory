#!/usr/local/bin/perl

# does the html version of the grad-date address list
#

@INC=('/u/mjr/doc/mvhs', '/usr/local/lib/perl');
require 'mv_util.pl';

$htmlname = "class.html";
$today = localtime;

die "Usage: mv_grad_html infile.adr outfile.html\n" if !$ARGV[0] || !$ARGV[1];
open(FMTOUT,">$ARGV[1]") || die "Can't open $ARGV[1]: $!\n";

print FMTOUT &common_html_hdr(2);
open(MVHSPRE,$ARGV[0]) || die "Can't open $ARGV[0]: $!\n";
print FMTOUT "<br>
<table cellspacing=0 cellpadding=1 border=0 width=\"100%\">
  <tr>
    <td bgcolor=\"#000000\" align=center>
    <table cellspacing=0 cellpadding=5 border=0 width=\"100%\">
      <tr>
        <td bgcolor=\"#eeee88\" align=center valign=middle>
        <strong><font size=\"+1\">A</font>&nbsp;L&nbsp;U&nbsp;M&nbsp;N&nbsp;I&nbsp;&nbsp; <font size=\"+1\">L</font>&nbsp;I&nbsp;S&nbsp;T&nbsp;E&nbsp;D&nbsp;&nbsp; B&nbsp;Y&nbsp;&nbsp; <font size=\"+1\">G</font>&nbsp;R&nbsp;A&nbsp;D&nbsp;U&nbsp;A&nbsp;T&nbsp;I&nbsp;N&nbsp;G&nbsp;&nbsp; <font size=\"+1\">C</font>&nbsp;L&nbsp;A&nbsp;S&nbsp;S</strong>
        </td>
      </tr>
    </table>
    </td>
  </tr>
</table>
";
print FMTOUT "<p>Index: <tt>";
$lastYear = '00';
$first_fac_staff = 0;
while(<MVHSPRE>) {
    chop;

    ($time,$id,$req,$last,$first,$school,$year,$email,$alias,$homepage) = &mv_parse($_);

    if ($lastYear ne $year) {
	$lastYear = $year;
	if (substr($year, 0, 1) =~ /[A-Za-z]/) {
	    print FMTOUT "<a href=\"#fac_staff\">Faculty/Staff</a>\n" unless $first_fac_staff;
	    $first_fac_staff = 1;
	} else {
	    $hashYear = 'grad' . $year;
	    print FMTOUT "<a href=\"#$hashYear\">$lastYear</a> ";
	}
    }
}
close(MVHSPRE);
print FMTOUT "</tt>\n";
print FMTOUT "<pre>Name                                      Email
---------------------------------------------------------------------------";

open(MVHS,$ARGV[0]) || die "Can't open $ARGV[0]: $!\n";
$lastYear = '00';
$first_fac_staff = 0;
while(<MVHS>) {
    chop;
    ($time,$id,$req,$last,$first,$school,$year,$email,$alias,$homepage) = &mv_parse($_);

    if ($lastYear ne $year) {
	$lastYear = $year;
	if (substr($year, 0, 1) =~ /[A-Za-z]/) {
            print FMTOUT "\n";
	    print FMTOUT "<a name=\"fac_staff\">" unless $first_fac_staff;
            print FMTOUT $lastYear;
            print FMTOUT "</a>" unless $first_fac_staff;
            print FMTOUT ' ' x (12 - length($lastYear));
            print FMTOUT "  (<a href=\"$htmlname\">top</a>)\n";
            $first_fac_staff = 1;
	} else {
	    $hashYear = 'grad' . $year;
	    print FMTOUT "\n<a name=\"$hashYear\">Class of '$lastYear</a>  (<a href=\"$htmlname\">top</a>)\n";
	}
    }
    if ($first) {
       $fullname = "$last, $first";
    } else {
       $fullname = $last;
    }

    if ($school ne 'MVHS' && $school ne '') {
	$affil     = "  [$school]";
	$affil_len = length("  [$school]");
    } else {
	$affil     = "";
	$affil_len = 0;
    }

    print FMTOUT '  ';
    print FMTOUT "<a name=\"$alias\"";
    print FMTOUT " href=\"$homepage\"" if $homepage ne '';
    print FMTOUT ">";
    print FMTOUT $fullname;
    print FMTOUT "</a>";
    print FMTOUT $affil;
    print FMTOUT ' ' x (40 - (length($fullname) + $affil_len));
    print FMTOUT "<a href=\"mailto:", $email, "\">", $email, "</a>";
    print FMTOUT " <img alt=\"[new]\" WIDTH=28 HEIGHT=11 SRC=\"new.gif\">" if &is_new($time);
    print FMTOUT "\n";
}

print FMTOUT "</PRE>\n";
print FMTOUT &common_html_ftr;

exit(0);
