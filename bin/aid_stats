#!/usr/bin/perl -w

# $Id: aid_stats,v 1.8 1999/02/09 00:53:17 mradwin Exp mradwin $

require 'aid_util.pl';
require 'ctime.pl';

$dbmfile = &aid_config('wwwdir') . 'master';
die "can't open ${dbmfile}.db\n" unless -r "${dbmfile}.db";
dbmopen(DB,$dbmfile,0444);

$nvalid = 0;
$ndubious = 0;
$ntotal = 0;
@nreq = (0, 0, 0, 0, 0);
$nreunion = 0;
$nlocation = 0;
$nweb = 0;
$nnews = 0;

while (($key,$val) = each %DB)
{
    next unless $key =~ /^\d+$/;

    %rec = &aid_db_unpack_rec($key,$val);

    $ntotal++;

    next unless $rec{'valid'};

    if ($rec{'bounce'} ne '0')
    {
	$ndubious++;
    }
    else
    {
	$nvalid++;
    }

    $nreq[$rec{'request'}]++;

    $nreunion++ if $rec{'reunion'};
    $nlocation++ if $rec{'location'} ne '';
    $nweb++ if $rec{'www'} ne '';
    $nnews++ if -f &aid_newsfile($rec{'id'});
}

print "Mountain View High School Alumni Internet Directory\n";
print "Member Statistics\n";
print "------------------------------------------------------------------------\n\n";

printf "%4d       total entries in the Directory\n",
    $ntotal;
printf "%4d (%2.0f%%) members w/valid   e-mail address\n",
    $nvalid, ((100 * $nvalid) / $ntotal);
printf "%4d (%2.0f%%) members w/valid   e-mail address but bounced recently\n",
    $ndubious, ((100 * $ndubious) / $ntotal);

$nlegit = $nvalid + $ndubious;

printf "%4d (%2.0f%%) members w/invalid e-mail address\n",
    ($ntotal - $nlegit), ((100 * ($ntotal - $nlegit)) / $ntotal);

printf "%4d (%2.0f%%) requesting quarterly digests:\n",
    ($nreq[1] + $nreq[2] + $nreq[3] + $nreq[4]),
    ((100 * ($nreq[1] + $nreq[2] + $nreq[3] + $nreq[4])) / $nlegit);

printf "    %4d - %s\n", $nreq[1], $aid_util'req_descr_long[1];
printf "    %4d - %s\n", $nreq[2], $aid_util'req_descr_long[2];
printf "    %4d - %s\n", $nreq[3], $aid_util'req_descr_long[3];
printf "    %4d - %s\n", $nreq[4], $aid_util'req_descr_long[4];

printf "%4d (%2.0f%%) allow class officers to mail reunion info\n",
    $nreunion, ((100 * $nreunion) / $nlegit);
printf "%4d (%2.0f%%) wrote some location info\n",
    $nlocation, ((100 * $nlocation) / $nlegit);
printf "%4d (%2.0f%%) have personal web page\n",
    $nweb, ((100 * $nweb) / $nlegit);
printf "%4d (%2.0f%%) wrote What's New? paragraph\n",
    $nnews, ((100 * $nnews) / $nlegit);

print "\n------------------------------------------------------------------------\n";
print &ctime(time);

dbmclose(DB);
