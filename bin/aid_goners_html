#!/usr/local/bin/perl -w

#
# does the html version of the invalid address list
# $Id: aid_goners_html,v 1.27 1998/01/03 11:38:28 mjr Exp mjr $
#

require 'aid_util.pl';

die "Usage: aid_goners_html infile.adr outfile.html\n" if !$ARGV[0] || !$ARGV[1];
open(DATA,$ARGV[0]) || die "Can't open $ARGV[0]: $!\n";
open(FMTOUT,">$ARGV[1]") || die "Can't open $ARGV[1]: $!\n";

print FMTOUT &common_html_hdr(-1,1);
print FMTOUT "<br>";
print FMTOUT &aid_tableheader('Alumni with Invalid Addresses');
print FMTOUT "
<p>The following addresses are invalid because either email to them
bounces, or the address is being used by a new owner.  If you know a
current email address for anyone on this list, please submit it!</p>
";
print FMTOUT "<pre>";
print FMTOUT "Name and Graduation Year                  Last known whereabouts\n";
print FMTOUT "---------------------------------------------------------------------------\n";

while(<DATA>) {
    chop;
    %rec = &aid_split($_);

    $fullname = &fullname(*rec);
    ($affil,$len) = &affiliate(*rec,0);

    # now that we've grabbed the fullname, modify the parts that
    # are likely to be bad for x-url-encoded.  Don't do anything fancy,
    # just replace spaces with plusses.
    $rec{'first'} =~ s/[ \t]/+/g;
    $rec{'last'} =~ s/[ \t]/+/g;
    $rec{'married'} =~ s/[ \t]/+/g;
    $rec{'location} =~ s/[ \t]/+/g;
    $rec{'year'} =~ s/[ \t]/+/g;

    print FMTOUT "<a href=\"", &aid_config('cgi_path'), "?revise";
    foreach (keys %rec) {
	print FMTOUT "&$_=$rec{$_}";
    }
    print FMTOUT "\">";
    print FMTOUT $fullname;
    print FMTOUT "</a>";
    print FMTOUT $affil;
    print FMTOUT ' ', ' ' x (41 - (length($fullname) + $len));
    print FMTOUT $rec{'email'};
    print FMTOUT "\n";
}

print FMTOUT "</pre>\n";
print FMTOUT &common_html_ftr(-1, "Invalid&nbsp;Addresses");

exit(0);
